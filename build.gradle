/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.5/userguide/java_library_plugin.html
 */

//---------------------- 公共部分 ----------------------//

//系统启动初始化：自动下载插件
buildscript {
    repositories {
    	maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' } //阿里云
    }
    dependencies {
        //GWT编译
        classpath 'de.richsource.gradle.plugins:gwt-gradle-plugin:0.6'
    }
}

//公共仓库配置
repositories {
    maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' } //阿里云
    maven { url 'http://svn.higtek.cn:8080/nexus/content/groups/public/'  //自建仓库
        credentials {
            username 'developer'
            password 'developer@higtek.cn'
        }
    }
}

//---------------------- JAVA 编译插件 ----------------------//

apply plugin: 'java-library'

//JAVA 文件编码
compileJava.options.encoding = 'UTF-8'
tasks.withType(JavaCompile) {  
    options.encoding = "UTF-8"  
}

//JAVA兼容性设置
sourceCompatibility = '1.7'
targetCompatibility = '1.7'

//---------------------- GWT 编译插件 ----------------------//

apply plugin: 'gwt'

gwt {
	gwtVersion='2.6.1'

	modules 'org.ccframe.client.Client'

	minHeapSize = "1024M";
	maxHeapSize = "1280M";
	sourceLevel = "1.7";

	compiler {
		strict = true;
		// style = "DETAILED"; //关闭混淆
	}
}

//复制到war包下的任务
task copyClient(type: Sync) {
    from rootDir.getAbsolutePath() + './build/gwt/out/client'
    into rootDir.getAbsolutePath() + './war/client'
}

//---------------------- WAR 打包插件 ----------------------//

apply plugin: 'war'
webAppDirName = './war'

war {
    exclude 'WEB-INF/lib/**'
    exclude 'WEB-INF/classes/**'
    exclude 'WEB-INF/deploy/**'
    exclude 'WEB-INF/eshome/esdata/**'

	manifest {
    	attributes 'projectName': 'bikeserver'
    	attributes 'releaseTime': new Date().format("yyyy-MM-dd_HH-mm-ss", TimeZone.getTimeZone("UTC"))
    	attributes 'buildNumber': System.getenv().BUILD_NUMBER == null ? 'debug' : System.getenv().BUILD_NUMBER?.toInteger()
    	attributes 'svnVersion': System.getenv().SVN_REVISION == null ? 'debug' : System.getenv().SVN_REVISION?.toInteger()
    }
}

//----------------------- 编译JAR依赖配置 ------------------------//
configurations.all { //默认不自动关联依赖，以免打包过大
   transitive = false
}

dependencies {
    //参与编译与发布.
    api 'org.apache.ant:ant:1.9.9'
    api 'antlr:antlr:2.7.7'
    api 'aopalliance:aopalliance:1.0'
    api 'org.aspectj:aspectjrt:1.8.10'
    api 'org.aspectj:aspectjweaver:1.8.10'
    api 'cglib:cglib-nodep:3.2.5'
    api 'com.fasterxml:classmate:1.3.3'
    api 'commons-codec:commons-codec:1.10'
    api 'commons-collections:commons-collections:3.2.2'
    api 'commons-fileupload:commons-fileupload:1.3.3'
    api 'commons-io:commons-io:2.5'
    api 'commons-jxpath:commons-jxpath:1.3'
    api 'commons-lang:commons-lang:2.6'
    api 'org.apache.commons:commons-lang3:3.6'
    api 'commons-logging:commons-logging:1.2'
    api 'com.ning:compress-lzf:1.0.4'
    api 'org.dbunit:dbunit:2.5.3'
    api 'org.dom4j:dom4j:2.0.1'
    api 'com.alibaba:druid:1.1.2'
    api 'net.sf.ehcache.internal:ehcache-core:2.10.4'
    api 'org.elasticsearch:elasticsearch:2.4.4' //TODO，插件编译的时候还是244，可以考虑重新编译后升级
    api 'com.alibaba:fastjson:1.2.34'
    api 'org.apache.geronimo.specs:geronimo-jta_1.1_spec:1.1.1'
    api 'com.google.guava:guava:20.0' //guava>20.0需要java8
    api 'com.flipthebird.gwt-hashcode-equals:gwt-hashcode-equals:0.1.0'
    api 'org.hibernate.common:hibernate-commons-annotations:5.0.1.Final'
    api 'org.hibernate:hibernate-core:5.2.10.Final'
    api 'org.hibernate.javax.persistence:hibernate-jpa-2.1-api:1.0.0.Final'
    api 'com.carrotsearch:hppc:0.7.2'
    api 'com.itextpdf:itext-asian:5.2.0'
    api 'com.itextpdf:itext-pdfa:5.5.11'
    api 'com.itextpdf:itext-xtra:5.5.11'
    api 'com.itextpdf:itextpdf:5.5.11'
    api 'com.fasterxml.jackson.core:jackson-annotations:2.8.9'
    api 'com.fasterxml.jackson.core:jackson-core:2.8.9'
    api 'com.fasterxml.jackson.core:jackson-databind:2.8.9'
    api 'com.fasterxml.jackson.dataformat:jackson-dataformat-smile:2.8.9'
    api 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.8.9'

//TODO 生成小图采用其它的方案
//    api 'javax.media:jai-codec:1.1.3'
//    api 'javax.media:jai-core:1.1.3'
//    api 'com.sun.media:jai_imageio:1.1'


    api 'org.javassist:javassist:3.21.0-GA'
    api 'org.jboss.logging:jboss-logging:3.3.1.Final'
    api 'joda-time:joda-time:2.9.9'
    api 'com.twitter:jsr166e:1.1.0'
    api 'javax.ws.rs:jsr311-api:1.1.1'
    api 'javax.servlet:jstl:1.2'
    api 'org.apache.logging.log4j:log4j-1.2-api:2.8.2'
    api 'org.apache.logging.log4j:log4j-api:2.8.2'
    api 'org.apache.logging.log4j:log4j-core:2.8.2'
    api 'org.apache.logging.log4j:log4j-slf4j-impl:2.8.2'
    api 'org.bgee.log4jdbc-log4j2:log4jdbc-log4j2-jdbc4.1:1.16'
    api 'org.apache.lucene:lucene-analyzers-common:5.5.4'
    api 'org.apache.lucene:lucene-core:5.5.4'
    api 'org.apache.lucene:lucene-highlighter:5.5.4'
    api 'org.apache.lucene:lucene-join:5.5.2'
    api 'org.apache.lucene:lucene-memory:5.5.2'
    api 'org.apache.lucene:lucene-queries:5.5.2'
    api 'org.apache.lucene:lucene-queryparser:5.5.2'
    api 'org.apache.lucene:lucene-spatial:5.5.2'
    api 'org.apache.lucene:lucene-suggest:5.5.2'
    api 'mysql:mysql-connector-java:5.1.42'
    api 'io.netty:netty-all:4.1.13.Final'
    api 'com.belerweb:pinyin4j:2.5.1'
    api 'org.apache.poi:poi:3.14' //3.16要commons-collection4，700多k，暂不更新
    api 'org.apache.poi:poi-ooxml:3.14'
    api 'org.apache.poi:poi-ooxml-schemas:3.14'
    api 'org.apache.poi:poi-scratchpad:3.14'
    api 'cn.apiclub.tool:simplecaptcha:1.2.2'
    api 'org.slf4j:slf4j-api:1.7.25'
    api 'org.yaml:snakeyaml:1.18'
    api 'org.springframework:spring-aop:4.3.9.RELEASE'
    api 'org.springframework:spring-beans:4.3.9.RELEASE'
    api 'org.springframework:spring-context:4.3.9.RELEASE'
    api 'org.springframework:spring-context-support:4.3.9.RELEASE'
    api 'org.springframework:spring-core:4.3.9.RELEASE'
    api 'org.springframework.data:spring-data-commons:1.13.4.RELEASE'
    api 'org.springframework.data:spring-data-elasticsearch:2.1.4.RELEASE'
    api 'org.springframework.data:spring-data-jpa:1.11.4.RELEASE'
    api 'org.springframework:spring-expression:4.3.9.RELEASE'
    api 'org.springframework:spring-jdbc:4.3.9.RELEASE'
    api 'org.springframework:spring-orm:4.3.9.RELEASE'
    api 'org.springframework:spring-tx:4.3.9.RELEASE'
    api 'org.springframework:spring-web:4.3.9.RELEASE'
    api 'org.springframework:spring-webmvc:4.3.9.RELEASE'
    api 'org.springframework:spring-websocket:4.3.9.RELEASE'
    api 'org.terracotta:statistics:1.4.4'
    api 'com.tdunning:t-digest:3.1'
    api 'net.coobird:thumbnailator:0.4.8'
//    api 'com.foxinmy:weixin4j-base:1.7.7'
//    api 'com.foxinmy:weixin4j-mp:1.7.7.jar'

    //参与编译但是不进行发布.
    //guice
    providedCompile 'com.google.gwt.inject:gin:2.1.2'
    providedCompile 'com.google.inject:guice:3.0' //gin bridge只支持到3.0
    providedCompile 'com.google.inject.extensions:guice-assistedinject:3.0'
    providedCompile 'javax.inject:javax.inject:1'
	
	//gwt 2.6.1
    providedCompile ('com.fasterxml.jackson.core:jackson-databind:2.8.9'){
		artifact {
			name = 'jackson-databind'
			type = 'jar'
			classifier = 'sources'
		}
    }
    providedCompile 'com.google.gwt:gwt-dev:2.6.1'
    providedCompile 'com.google.gwt:gwt-user:2.6.1'
    providedCompile 'com.google.gwt:gwt-servlet:2.6.1'
    providedCompile 'com.google.gwt:gwt-servlet-deps:2.6.1'
    providedCompile ('javax.validation:validation-api:1.0.0.GA') {
		artifact {
			name = 'validation-api'
			type = 'jar'
		}
		artifact {
			name = 'validation-api'
			type = 'jar'
			classifier = 'sources'
		}
	}
	
	//gxt
    providedCompile 'com.sencha.gxt:gxt-chart:3.1.1'
    providedCompile 'com.sencha.gxt:gxt-legacy:3.1.1'
    providedCompile 'com.sencha.gxt:gxt:3.1.1'

	//其它编译但是不需要发布的
    providedCompile 'javax.servlet:servlet-api:2.5'
    providedCompile 'javax.servlet.jsp:jsp-api:2.1'
    providedCompile 'org.apache.ant:ant-launcher:1.10.1'
    providedCompile 'org.vectomatic:lib-gwt-file:0.3.8'
    providedCompile 'org.fusesource.restygwt:restygwt:2.1.1' //2.2.0需要gwt-jackson,gwt2.7
    
    
    //自定义仓库的
    providedCompile 'org.ccframe:gwttheme-freshbizz:1.0'

    //参与测试不进行发布
    testImplementation 'junit:junit:4.8' //4.11的版本需要额外包
    
}



